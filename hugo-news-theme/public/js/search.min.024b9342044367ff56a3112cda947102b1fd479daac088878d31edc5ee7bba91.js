document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("search-toggle"),e=document.getElementById("search-modal"),o=document.getElementById("search-close"),i=document.getElementById("search-input"),t=document.getElementById("search-results");let n,a=!1;s&&s.addEventListener("click",()=>{e.classList.remove("hidden","opacity-0","pointer-events-none"),setTimeout(()=>{i.focus()},100)}),o&&o.addEventListener("click",()=>{e.classList.add("hidden","opacity-0","pointer-events-none")}),e.addEventListener("click",t=>{t.target===e&&e.classList.add("hidden","opacity-0","pointer-events-none")}),document.addEventListener("keydown",t=>{t.key==="Escape"&&!e.classList.contains("hidden")&&e.classList.add("hidden","opacity-0","pointer-events-none")}),i.addEventListener("input",async e=>{const s=e.target.value;if(!a)try{const e=await fetch("/index.json?v="+(new Date).getTime()),t=await e.json(),s={keys:["title","summary","content","category","tags","people","locations"],threshold:.4,ignoreLocation:!0};n=new Fuse(t,s),a=!0}catch(e){console.error("Error loading search index:",e);return}if(s.length>2&&n){const e=n.search(s);r(e)}else t.innerHTML=""});function r(e){if(t.innerHTML="",e.length===0){t.innerHTML='<p class="text-center text-muted-foreground">لا توجد نتائج</p>';return}e.slice(0,10).forEach(e=>{const n=e.item,s=document.createElement("a");s.href=n.permalink,s.className="block p-4 border border-border rounded-lg hover:bg-muted/50 transition-colors group",s.innerHTML=`
                <h3 class="text-xl font-bold mb-1 text-primary group-hover:underline">${n.title}</h3>
                <div class="text-xs text-muted-foreground mb-2 flex items-center gap-2">
                    ${n.image?`<span class="text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full">صورة</span>`:""}
                    <span>${n.category}</span>
                </div>
                <p class="text-sm text-foreground/80 line-clamp-2 leading-relaxed">${n.summary}</p>
            `,t.appendChild(s)})}})