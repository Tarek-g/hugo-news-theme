<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

{{/* --- DARK MODE: Prevent FOUC (Flash of Unstyled Content) --- */}}
<script>
  (function() {
    const saved = localStorage.getItem('hugo-news-theme');
    const theme = saved || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    document.documentElement.classList.add(theme);
  })();
</script>
<title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>

{{/* --- SEO META TAGS --- */}}
<meta name="description" content="{{ .Params.Description | default .Site.Params.description }}" />
<meta name="keywords" content="{{ .Params.Keywords | default .Site.Params.keywords }}" />
<link rel="canonical" href="{{ .Permalink }}" />

{{ if not .IsPage }}
  {{ if .Paginator }}
    {{ if .Paginator.HasPrev }}<link rel="prev" href="{{ .Paginator.Prev.URL }}" />{{ end }}
    {{ if .Paginator.HasNext }}<link rel="next" href="{{ .Paginator.Next.URL }}" />{{ end }}
  {{ end }}
{{ end }}

{{/* --- OPEN GRAPH --- */}}
{{ $ogImage := .Params.image | default "/images/og-default.png" }}
<meta property="og:title" content="{{ .Title | default .Site.Title }}" />
<meta property="og:description" content="{{ .Params.Description | default .Site.Params.description }}" />
<meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />
<meta property="og:image" content="{{ $ogImage | absURL }}" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:locale" content="ar_SA" />

{{/* --- TWITTER CARDS --- */}}
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ .Title | default .Site.Title }}" />
<meta name="twitter:description" content="{{ .Params.Description | default .Site.Params.description }}" />
<meta name="twitter:image" content="{{ $ogImage | absURL }}" />

<link rel="icon" type="image/png" href="/favicon.png" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

{{/* --- DYNAMIC FONTS --- */}}
<link href="{{ site.Params.fonts.google_fonts_url }}" rel="stylesheet">

{{/* --- DYNAMIC THEMING --- */}}
<style>
  :root {
    {{ with site.Params.colors }}
    --primary: {{ .primary }};
    --secondary: {{ .secondary }};
    --background: {{ .background }};
    --foreground: {{ .foreground }};
    {{ end }}
    {{ with site.Params.fonts }}
    --font-sans: {{ .heading_font | safeCSS }};
    --font-serif: {{ .body_font | safeCSS }};
    {{ end }}
  }
</style>

{{ $style := resources.Get "css/main.css" | css.PostCSS | fingerprint "sha256" }}
<link rel="stylesheet" href="{{ $style.RelPermalink }}">

{{/* --- LOAD JS: Theme & Search --- */}}
{{ $themeJS := resources.Get "js/theme.js" | minify | fingerprint "sha256" }}
{{ $searchJS := resources.Get "js/search.js" | minify | fingerprint "sha256" }}
<script defer src="{{ $themeJS.RelPermalink }}"></script>
<script defer src="{{ $searchJS.RelPermalink }}"></script>

{{/* --- SCHEMA.ORG JSON-LD --- */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ if .IsHome }}WebSite{{ else }}NewsArticle{{ end }}",
  "headline": "{{ .Title }}",
  "description": "{{ .Params.Description | default .Site.Params.description }}",
  "url": "{{ .Permalink }}",
  "author": {
    "@type": "Person",
    "name": "{{ .Params.author | default .Site.Params.author }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ "favicon.png" | absURL }}"
    }
  },
  "datePublished": "{{ .Date.Format "2006-01-02" }}"
}
</script>

{{/* --- BREADCRUMB SCHEMA --- */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "الرئيسية",
      "item": "{{ site.BaseURL }}"
    }{{ if not .IsHome }},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ .Title }}",
      "item": "{{ .Permalink }}"
    }{{ end }}
  ]
}
</script>
