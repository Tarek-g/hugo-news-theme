{{ define "main" }}
<div class="container mx-auto px-4 py-8">

    {{/* --- BREADCRUMBS (ŸÅÿ™ÿßÿ™ ÿßŸÑÿÆÿ®ÿ≤) - Enhanced --- */}}
    <nav aria-label="breadcrumb" class="mb-6">
        <ol class="flex items-center gap-2 text-sm text-muted-foreground flex-wrap">
            <li>
                <a href="/" class="hover:text-primary transition-colors duration-300">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a>
            </li>
            <li class="flex items-center gap-2">
                <span class="text-primary/40">/</span>
                {{ if .CurrentSection }}
                <a href="{{ .CurrentSection.RelPermalink }}" class="hover:text-primary transition-colors duration-300">
                    {{ if eq .CurrentSection.Title "Posts" }}ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™{{ else }}{{ .CurrentSection.Title }}{{ end }}
                </a>
                {{ end }}
            </li>
            {{/* ÿßŸÑŸÇÿ≥ŸÖ */}}
            {{ with index .Params.categories 0 }}
            <li class="flex items-center gap-2">
                <span class="text-primary/40">/</span>
                <a href="/categories/{{ . | urlize }}/" class="hover:text-primary transition-colors duration-300">
                    {{ . }}
                </a>
            </li>
            {{ end }}
            <li class="flex items-center gap-2">
                <span class="text-primary/40">/</span>
                <span class="text-foreground font-medium truncate max-w-[200px]">{{ .Title }}</span>
            </li>
        </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

        {{/* --- MAIN CONTENT (8 Columns) --- */}}
        <main class="lg:col-span-8">
            <article class="glass-card p-0 lg:p-8">
                <header class="mb-8 stagger-container">
                    {{/* --- METADATA --- */}}
                    <div class="flex items-center gap-3 mb-4 flex-wrap">
                        {{ with index .Params.categories 0 }}
                        <a href="/categories/{{ . | urlize }}/"
                            class="bg-primary text-primary-foreground px-4 py-1.5 text-sm font-bold rounded-sm hover:opacity-90 transition-all duration-300 shadow-glow">
                            {{ . }}
                        </a>
                        {{ end }}
                        <span class="text-muted-foreground text-sm font-mono flex items-center gap-1">
                            üìÖ {{ .Date.Format "2 January 2006" }}
                        </span>
                        {{ if ne .Lastmod .Date }}
                        <span class="text-muted-foreground text-sm font-mono flex items-center gap-1">
                            üîÑ {{ .Lastmod.Format "2 January 2006" }}
                        </span>
                        {{ end }}
                        <span class="text-muted-foreground text-sm font-mono flex items-center gap-1">
                            ‚è±Ô∏è
                            {{ $readTime := math.Round (div (countwords .Content) 200.0) }}
                            {{ if lt $readTime 1.0 }}1{{ else }}{{ $readTime }}{{ end }} {{ i18n "minute" }}
                        </span>
                    </div>

                    {{/* --- TITLE (TYPE SCALE) - Premium --- */}}
                    <h1
                        class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-black leading-tight mb-6 text-balance tracking-tight">
                        {{ .Title }}
                    </h1>

                    {{/* --- AUTHOR --- */}}
                    {{ with .Params.author }}
                    <div class="flex items-center gap-3 text-sm font-semibold text-primary mb-6">
                        <span class="w-8 h-0.5 bg-primary"></span>
                        <span>‚úçÔ∏è {{ i18n "by" }}: <span class="font-bold">{{ . }}</span></span>
                    </div>
                    {{ end }}

                    {{/* --- SOCIAL SHARE - Enhanced --- */}}
                    <div class="flex items-center gap-4 mt-6 pt-6 border-t border-border/50 flex-wrap">
                        <span class="text-sm font-bold text-muted-foreground">{{ i18n "share" }}:</span>
                        <a href="https://twitter.com/intent/tweet?text={{ .Title }}&url={{ .Permalink }}"
                            target="_blank" rel="noopener noreferrer"
                            class="p-2.5 glass-card rounded-full hover:bg-primary hover:text-white transition-all duration-300 hover-glow">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path
                                    d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z">
                                </path>
                            </svg>
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" target="_blank"
                            rel="noopener noreferrer"
                            class="p-2.5 glass-card rounded-full hover:bg-primary hover:text-white transition-all duration-300 hover-glow">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                            </svg>
                        </a>
                        <a href="https://wa.me/?text={{ .Title }} {{ .Permalink }}" target="_blank"
                            rel="noopener noreferrer"
                            class="p-2.5 glass-card rounded-full hover:bg-primary hover:text-white transition-all duration-300 hover-glow">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path
                                    d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                                </path>
                            </svg>
                        </a>
                    </div>
                </header>

                {{/* --- FEATURED IMAGE --- */}}
                {{ with .Params.image }}
                <div class="mb-8 rounded-lg overflow-hidden">
                    <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy"
                        class="w-full h-auto object-cover max-h-[500px] hover:scale-105 transition-transform duration-700">
                </div>
                {{ end }}

                {{/* --- TABLE OF CONTENTS (NORMAL AT START) - Glass --- */}}
                {{ $h2s := findRE `<h2 id="[^" ]*">.*?</h2>` .Content }}
                {{ if gt (len $h2s) 0 }}
                <nav class="toc-desktop mb-8 glass-card p-6 border-r-4 border-primary">
                    <h3 class="font-bold mb-4 text-sm flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-primary animate-glow-pulse"></span>
                        üìë {{ i18n "table_of_contents" | default "ŸÖÿ≠ÿ™ŸàŸäÿßÿ™ ÿßŸÑŸÖŸÇÿßŸÑ" }}
                    </h3>
                    <ul class="text-sm space-y-3">
                        {{ range $h2s }}
                        {{ $id := replaceRE `<h2 id="([^" ]*)".*` "$1" . }} {{ $text :=. | plainify }} <li>
                            <a href='#{{ $id }}'
                                class="transition-all duration-300 text-muted-foreground hover:text-primary hover:pr-2 cursor-pointer block py-1">
                                {{ $text }}
                            </a>
                            </li>
                            {{ end }}
                    </ul>
                </nav>

                {{/* --- TABLE OF CONTENTS (STICKY ON SCROLL) - Glass Enhanced --- */}}
                <nav
                    class="toc-sticky hidden sticky top-20 z-40 mb-8 glass-elevated rounded-lg shadow-xl overflow-hidden transition-all duration-300">
                    <div
                        class="toc-sticky-header bg-primary text-primary-foreground p-4 cursor-pointer flex justify-between items-center">
                        <h3 class="font-bold text-lg flex items-center gap-2">
                            üìë {{ i18n "table_of_contents" | default "ŸÖÿ≠ÿ™ŸàŸäÿßÿ™ ÿßŸÑŸÖŸÇÿßŸÑ" }}
                        </h3>
                        <span class="toc-icon transition-transform duration-300">‚ñº</span>
                    </div>
                    <ul
                        class="toc-sticky-content text-sm space-y-2 hidden transition-all duration-300 p-4 max-h-[70vh] overflow-y-auto custom-scrollbar">
                        {{ range $h2s }}
                        {{ $id := replaceRE `<h2 id="([^" ]*)".*` "$1" . }} {{ $text :=. | plainify }} <li>
                            <a href='#{{ $id }}'
                                class="transition-all duration-300 text-muted-foreground hover:text-primary cursor-pointer block hover:pr-2 py-1">
                                {{ $text }}
                            </a>
                            </li>
                            {{ end }}
                    </ul>
                </nav>
                {{ end }}

                {{/* --- ARTICLE CONTENT (WITH TYPE SCALE) - Enhanced --- */}}
                <div class="prose prose-lg dark:prose-invert max-w-none font-serif 
                    [&_p]:my-6 [&_p]:text-lg [&_p]:leading-[2]
                    [&_h2]:text-3xl [&_h2]:font-bold [&_h2]:mt-10 [&_h2]:mb-6 [&_h2]:text-foreground [&_h2]:border-b [&_h2]:border-border [&_h2]:pb-3
                    [&_h3]:text-2xl [&_h3]:font-semibold [&_h3]:mt-8 [&_h3]:mb-4 [&_h3]:text-foreground
                    [&_h4]:text-xl [&_h4]:font-semibold [&_h4]:mt-6 [&_h4]:mb-3
                    [&_strong]:font-bold [&_strong]:text-primary
                    [&_em]:italic [&_em]:text-muted-foreground
                    [&_a]:text-primary [&_a]:hover:underline [&_a]:transition-colors
                    [&_blockquote]:border-r-4 [&_blockquote]:border-primary [&_blockquote]:pr-6 [&_blockquote]:py-4 [&_blockquote]:bg-primary/5 [&_blockquote]:rounded-sm [&_blockquote]:my-8
                    [&_ul]:my-6 [&_ul]:space-y-2 [&_ul]:pr-6
                    [&_ol]:my-6 [&_ol]:space-y-2 [&_ol]:pr-6
                    [&_li]:text-lg [&_li]:leading-relaxed
                    [&_code]:bg-secondary [&_code]:px-2 [&_code]:py-1 [&_code]:rounded [&_code]:text-sm [&_code]:text-primary [&_code]:font-mono
                    [&_pre]:bg-slate-900 [&_pre]:text-white [&_pre]:p-6 [&_pre]:rounded-lg [&_pre]:overflow-x-auto [&_pre]:my-8
                    text-lg md:text-lg leading-[2]">
                    {{ .Content }}
                </div>

                {{/* --- DYNAMIC TAXONOMIES (TAGS) - Enhanced --- */}}
                <div class="mt-12 space-y-4">
                    {{ range $taxonomyname, $taxonomy := .Site.Taxonomies }}
                    {{ if (not (eq $taxonomyname "categories")) }}
                    {{ with (index $.Params $taxonomyname) }}
                    <div class="flex flex-wrap items-start gap-3">
                        <span class="font-bold text-muted-foreground capitalize whitespace-nowrap">
                            {{ i18n $taxonomyname | default ($taxonomyname | humanize) }}:
                        </span>
                        <div class="flex flex-wrap gap-2">
                            {{ range . }}
                            {{ $termURL := printf "/%s/%s" $taxonomyname (. | urlize) | absURL }}
                            <a href="{{ $termURL }}"
                                class="inline-flex items-center gap-1 glass-card px-4 py-2 rounded-full text-sm transition-all duration-300 font-medium hover:bg-primary hover:text-primary-foreground">
                                #{{ . }}
                            </a>
                            {{ end }}
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                    {{ end }}
                </div>

                {{/* --- AUTHOR BIO - Premium Glass --- */}}
                {{ with .Params.author }}
                <div class="mt-12 glass-elevated p-8 rounded-lg border-r-4 border-primary">
                    <div class="flex items-start gap-6">
                        <div class="flex-shrink-0">
                            <div
                                class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center text-3xl neon-box">
                                ‚úçÔ∏è
                            </div>
                        </div>
                        <div class="flex-grow">
                            <h4 class="text-xl font-bold mb-2">{{ . }}</h4>
                            <p class="text-muted-foreground leading-relaxed">
                                {{ i18n "author_bio" | default "ŸÖÿ™ÿÆÿµÿµ ŸÅŸä ÿßŸÑÿ£ÿÆÿ®ÿßÿ±." }}
                            </p>
                        </div>
                    </div>
                </div>
                {{ end }}

                {{/* --- RELATED POSTS - Glass Cards --- */}}
                {{ $related := site.RegularPages.Related . | first 3 }}
                {{ with $related }}
                <div class="mt-16 pt-12 border-t-2 border-border">
                    <h3 class="text-3xl font-bold mb-8 flex items-center gap-3">
                        <span class="w-3 h-3 rounded-full bg-primary animate-glow-pulse"></span>
                        üìö {{ i18n "related_posts" }}
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 stagger-container">
                        {{ range . }}
                        <a href="{{ .RelPermalink }}" class="group block h-full">
                            <div class="glass-card p-4 h-full hover-lift">
                                {{ with .Params.image }}
                                <div class="overflow-hidden rounded-lg mb-4">
                                    <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy"
                                        class="w-full h-32 object-cover group-hover:scale-110 transition-transform duration-500">
                                </div>
                                {{ end }}
                                <h4
                                    class="font-bold text-lg group-hover:text-primary transition-colors duration-300 leading-snug mb-2">
                                    {{
                                    .Title }}</h4>
                                <p class="text-sm text-muted-foreground mb-3 line-clamp-2">{{ .Summary |
                                    truncate 80 }}</p>
                                <span
                                    class="text-xs text-primary font-semibold group-hover:translate-x-1 transition-transform duration-300 inline-block">
                                    ÿßŸÇÿ±ÿ£ ÿßŸÑŸÖÿ≤ŸäÿØ ‚Üê
                                </span>
                            </div>
                        </a>
                        {{ end }}
                    </div>
                </div>
                {{ end }}

                {{/* --- CALL TO ACTION - Neon Enhanced --- */}}
                <div
                    class="mt-16 p-10 bg-gradient-to-br from-primary/10 via-primary/5 to-transparent rounded-xl neon-border text-center relative overflow-hidden">
                    <!-- Decorative grid -->
                    <div class="absolute inset-0 tech-grid opacity-20"></div>

                    <div class="relative z-10">
                        <h3 class="text-2xl font-bold mb-3">{{ i18n "newsletter_title" }}</h3>
                        <p class="text-muted-foreground mb-6 max-w-md mx-auto">
                            {{ i18n "newsletter_description" }}
                        </p>
                        <a href="/newsletter/"
                            class="inline-block px-8 py-4 bg-primary text-primary-foreground rounded-lg font-bold hover:opacity-90 transition-all duration-300 shadow-glow hover:shadow-glow-lg">
                            {{ i18n "subscribe" }} ‚ûú
                        </a>
                    </div>
                </div>
            </article>
        </main>

        {{/* --- SIDEBAR (4 Columns) --- */}}
        <aside class="lg:col-span-4 space-y-8">
            {{ if .Site.Params.sidebar.enable }}
            {{ partial "sidebar.html" . }}
            {{ end }}
        </aside>

    </div>
</div>
{{ end }}