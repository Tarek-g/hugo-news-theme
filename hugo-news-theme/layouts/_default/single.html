{{ define "main" }}
<div class="container mx-auto px-4 py-12">
    <article class="max-w-4xl mx-auto">
        <header class="mb-8">
            <div class="flex items-center gap-2 mb-4">
                {{ with .Params.category }}
                <span class="bg-primary text-primary-foreground px-3 py-1 text-sm font-bold rounded-sm">{{ . }}</span>
                {{ end }}
                <span class="text-muted-foreground text-sm">{{ .Date.Format "2006-01-02" }}</span>
                <span class="text-muted-foreground text-sm mx-2">•</span>
                <span class="text-muted-foreground text-sm">⏱️ قراءة {{ math.Round (div (countwords .Content) 200.0) }}
                    دقيقة</span>
            </div>
            <h1 class="text-4xl md:text-6xl font-black leading-tight mb-6">{{ .Title }}</h1>
            {{ with .Params.author }}
            <div class="flex items-center gap-2 text-sm font-bold text-primary">
                <span>بقلـم: {{ . }}</span>
            </div>
            {{ end }}

            {{/* --- SOCIAL SHARE --- */}}
            <div class="flex items-center gap-3 mt-6 pt-6 border-t border-border">
                <span class="text-sm font-bold text-muted-foreground">مشاركة:</span>
                <a href="https://twitter.com/intent/tweet?text={{ .Title }}&url={{ .Permalink }}" target="_blank"
                    rel="noopener noreferrer"
                    class="p-2 bg-secondary rounded-full hover:bg-primary hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z">
                        </path>
                    </svg>
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" target="_blank"
                    rel="noopener noreferrer"
                    class="p-2 bg-secondary rounded-full hover:bg-primary hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                    </svg>
                </a>
                <a href="https://wa.me/?text={{ .Title }} {{ .Permalink }}" target="_blank" rel="noopener noreferrer"
                    class="p-2 bg-secondary rounded-full hover:bg-primary hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                        </path>
                    </svg>
                </a>
            </div>

        </header>

        {{ with .Params.image }}
        <div class="mb-8">
            <img src="{{ . }}" alt="" class="w-full h-auto rounded-sm object-cover max-h-[600px]">
        </div>
        {{ end }}

        <div class="prose prose-lg dark:prose-invert max-w-none font-serif leading-loose">
            {{ .Content }}

        </div>

        {{/* --- DYNAMIC TAXONOMIES (Tags, Locations, People, etc.) --- */}}
        <div class="mt-8 space-y-4">
            {{ range $taxonomyname, $taxonomy := .Site.Taxonomies }}
            {{ if (not (eq $taxonomyname "categories")) }}
            {{ with (index $.Params $taxonomyname) }}
            <div class="flex flex-wrap items-center gap-2">
                <span class="font-bold text-muted-foreground capitalize">{{ $taxonomyname | humanize }}:</span>
                {{ range . }}
                {{ $termURL := printf "/%s/%s" $taxonomyname (. | urlize) | absURL }}
                <a href="{{ $termURL }}"
                    class="bg-secondary text-secondary-foreground hover:bg-primary hover:text-primary-foreground px-3 py-1 rounded-full text-sm transition-colors">
                    #{{ . }}
                </a>
                {{ end }}
            </div>
            {{ end }}
            {{ end }}
            {{ end }}
        </div>

        {{/* --- RELATED POSTS --- */}}
        {{ $related := site.RegularPages.Related . | first 3 }}
        {{ with $related }}
        <div class="mt-16 pt-8 border-t-2 border-border">
            <h3 class="text-2xl font-bold mb-6">اقرأ أيضاً</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                {{ range . }}
                <a href="{{ .RelPermalink }}" class="group block">
                    {{ with .Params.image }}
                    <div class="overflow-hidden rounded-sm mb-3">
                        <img src="{{ . }}" alt="{{ $.Title }}"
                            class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-500">
                    </div>
                    {{ end }}
                    <h4 class="font-bold text-lg group-hover:text-primary transition-colors leading-snug">{{ .Title }}
                    </h4>
                </a>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </article>
</div>
{{ end }}