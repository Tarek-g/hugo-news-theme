{{ define "main" }}
<div class="container mx-auto px-4 py-8">
    
    {{/* --- BREADCRUMBS (ÙØªØ§Øª Ø§Ù„Ø®Ø¨Ø²) --- */}}
    <nav aria-label="breadcrumb" class="mb-6">
        <ol class="flex items-center gap-2 text-sm text-muted-foreground flex-wrap">
            <li>
                <a href="/" class="hover:text-primary transition-colors">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            </li>
            <li class="flex items-center gap-2">
                <span class="text-border">/</span>
                {{ if .CurrentSection }}
                <a href="{{ .CurrentSection.RelPermalink }}" class="hover:text-primary transition-colors">
                    {{ if eq .CurrentSection.Title "Posts" }}Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª{{ else }}{{ .CurrentSection.Title }}{{ end }}
                </a>
                {{ end }}
            </li>
            {{/* Ø§Ù„Ù‚Ø³Ù… */}}
            {{ with index .Params.categories 0 }}
            <li class="flex items-center gap-2">
                <span class="text-border">/</span>
                <a href="/categories/{{ . | urlize }}/" class="hover:text-primary transition-colors">
                    {{ . }}
                </a>
            </li>
            {{ end }}
            <li class="flex items-center gap-2">
                <span class="text-border">/</span>
                <span class="text-foreground font-medium truncate max-w-[200px]">{{ .Title }}</span>
            </li>
        </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

        {{/* --- MAIN CONTENT (8 Columns) --- */}}
        <main class="lg:col-span-8">
            <article class="bg-card rounded-lg p-0 lg:p-6">
                <header class="mb-8">
                    {{/* --- METADATA --- */}}
                    <div class="flex items-center gap-2 mb-4 flex-wrap">
                        {{ with index .Params.categories 0 }}
                        <a href="/categories/{{ . | urlize }}/"
                            class="bg-primary text-primary-foreground px-3 py-1 text-sm font-bold rounded-sm hover:opacity-90 transition-opacity">
                            {{ . }}
                        </a>
                        {{ end }}
                        <span class="text-muted-foreground text-sm">ğŸ“… {{ .Date.Format "2 January 2006" }}</span>
                        {{ if ne .Lastmod .Date }}
                        <span class="text-muted-foreground text-sm">ğŸ”„ {{ .Lastmod.Format "2 January 2006" }}</span>
                        {{ end }}
                        <span class="text-muted-foreground text-sm">â±ï¸ 
                            {{ $readTime := math.Round (div (countwords .Content) 200.0) }}
                            {{ if lt $readTime 1.0 }}1{{ else }}{{ $readTime }}{{ end }} {{ i18n "minute" }}</span>
                    </div>

                    {{/* --- TITLE (TYPE SCALE) --- */}}
                    <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-black leading-tight mb-6 text-balance">
                        {{ .Title }}
                    </h1>

                    {{/* --- AUTHOR --- */}}
                    {{ with .Params.author }}
                    <div class="flex items-center gap-2 text-sm font-semibold text-primary mb-6">
                        <span>âœï¸ {{ i18n "by" }}: <span class="font-bold">{{ . }}</span></span>
                    </div>
                    {{ end }}

                    {{/* --- SOCIAL SHARE --- */}}
                    <div class="flex items-center gap-3 mt-6 pt-6 border-t border-border flex-wrap">
                        <span class="text-sm font-bold text-muted-foreground">{{ i18n "share" }}:</span>
                        <a href="https://twitter.com/intent/tweet?text={{ .Title }}&url={{ .Permalink }}"
                            target="_blank" rel="noopener noreferrer"
                            class="p-2 bg-secondary rounded-full hover:bg-primary hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path
                                    d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z">
                                </path>
                            </svg>
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" target="_blank"
                            rel="noopener noreferrer"
                            class="p-2 bg-secondary rounded-full hover:bg-primary hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                            </svg>
                        </a>
                        <a href="https://wa.me/?text={{ .Title }} {{ .Permalink }}" target="_blank"
                            rel="noopener noreferrer"
                            class="p-2 bg-secondary rounded-full hover:bg-primary hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path
                                    d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                                </path>
                            </svg>
                        </a>
                    </div>
                </header>

                {{/* --- FEATURED IMAGE --- */}}
                {{ with .Params.image }}
                <div class="mb-8">
                    <img src="{{ . }}" 
                        alt="{{ $.Title }}" 
                        loading="lazy"
                        class="w-full h-auto rounded-sm object-cover max-h-[500px]">
                </div>
                {{ end }}

                {{/* --- TABLE OF CONTENTS (NORMAL AT START) --- */}}
                {{ $h2s := findRE `<h2 id="[^"]*">[^<]*</h2>` .Content }}
                {{ if gt (len $h2s) 0 }}
                <nav class="toc-desktop mb-8 bg-secondary/30 dark:bg-secondary/10 p-4 rounded-sm border-r-4 border-primary">
                    <h3 class="font-bold mb-3 text-sm flex items-center gap-2">ğŸ“‘ {{ i18n "table_of_contents" | default "Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø§Ù„" }}</h3>
                    <ul class="text-sm space-y-2">
                        {{ range $h2s }}
                        {{ $id := replaceRE `<h2 id="([^"]*)".*` "$1" . }}
                        {{ $text := replaceRE `.*>([^<]*)</h2>` "$1" . }}
                        <li>
                            <a href='#{{ $id }}' class="transition-colors text-muted-foreground hover:text-primary cursor-pointer">
                                {{ $text }}
                            </a>
                        </li>
                        {{ end }}
                    </ul>
                </nav>

                {{/* --- TABLE OF CONTENTS (STICKY ON SCROLL) --- */}}
                <nav class="toc-sticky hidden sticky top-20 z-40 mb-8 bg-white dark:bg-slate-900 rounded-sm border border-border shadow-lg">
                    <div class="toc-sticky-header bg-primary text-primary-foreground p-4 cursor-pointer rounded-t-sm border-b border-border">
                        <h3 class="font-bold text-lg flex items-center gap-2">
                            ğŸ“‘ {{ i18n "table_of_contents" | default "Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø§Ù„" }}
                        </h3>
                    </div>
                    <ul class="toc-sticky-content text-sm space-y-2 hidden transition-all duration-300 p-4 rounded-b-sm bg-white dark:bg-slate-900">
                        {{ range $h2s }}
                        {{ $id := replaceRE `<h2 id="([^"]*)".*` "$1" . }}
                        {{ $text := replaceRE `.*>([^<]*)</h2>` "$1" . }}
                        <li>
                            <a href='#{{ $id }}' class="transition-colors text-muted-foreground hover:text-primary cursor-pointer block hover:pl-2">
                                {{ $text }}
                            </a>
                        </li>
                        {{ end }}
                    </ul>
                </nav>
                {{ end }}

                {{/* --- ARTICLE CONTENT (WITH TYPE SCALE) --- */}}
                <div class="prose prose-lg dark:prose-invert max-w-none font-serif 
                    [&_p]:my-6 [&_p]:text-lg [&_p]:leading-[2]
                    [&_h2]:text-3xl [&_h2]:font-bold [&_h2]:mt-10 [&_h2]:mb-6 [&_h2]:text-foreground [&_h2]:border-b [&_h2]:border-border [&_h2]:pb-3
                    [&_h3]:text-2xl [&_h3]:font-semibold [&_h3]:mt-8 [&_h3]:mb-4 [&_h3]:text-foreground
                    [&_h4]:text-xl [&_h4]:font-semibold [&_h4]:mt-6 [&_h4]:mb-3
                    [&_strong]:font-bold [&_strong]:text-primary
                    [&_em]:italic [&_em]:text-muted-foreground
                    [&_a]:text-primary [&_a]:hover:underline
                    [&_blockquote]:border-r-4 [&_blockquote]:border-primary [&_blockquote]:pr-4 [&_blockquote]:py-2 [&_blockquote]:bg-secondary/20 [&_blockquote]:rounded-sm
                    [&_ul]:my-6 [&_ul]:space-y-2 [&_ul]:pr-6
                    [&_ol]:my-6 [&_ol]:space-y-2 [&_ol]:pr-6
                    [&_li]:text-lg [&_li]:leading-relaxed
                    [&_code]:bg-secondary [&_code]:px-2 [&_code]:py-1 [&_code]:rounded [&_code]:text-sm [&_code]:text-primary
                    [&_pre]:bg-slate-900 [&_pre]:text-white [&_pre]:p-4 [&_pre]:rounded [&_pre]:overflow-x-auto
                    text-lg md:text-lg leading-[2]">
                    {{ .Content }}
                </div>

                {{/* --- DYNAMIC TAXONOMIES (TAGS) --- */}}
                <div class="mt-12 space-y-4">
                    {{ range $taxonomyname, $taxonomy := .Site.Taxonomies }}
                    {{ if (not (eq $taxonomyname "categories")) }}
                    {{ with (index $.Params $taxonomyname) }}
                    <div class="flex flex-wrap items-start gap-3">
                        <span class="font-bold text-muted-foreground capitalize whitespace-nowrap">
                            {{ i18n $taxonomyname | default ($taxonomyname | humanize) }}:
                        </span>
                        <div class="flex flex-wrap gap-2">
                            {{ range . }}
                            {{ $termURL := printf "/%s/%s" $taxonomyname (. | urlize) | absURL }}
                            <a href="{{ $termURL }}"
                                class="inline-flex items-center gap-1 bg-secondary hover:bg-primary text-secondary-foreground hover:text-primary-foreground px-3 py-2 rounded-full text-sm transition-colors font-medium">
                                #{{ . }}
                            </a>
                            {{ end }}
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                    {{ end }}
                </div>

                {{/* --- AUTHOR BIO --- */}}
                {{ with .Params.author }}
                <div class="mt-12 p-6 bg-secondary/20 dark:bg-secondary/10 rounded-sm border-r-4 border-primary">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center text-2xl">
                                âœï¸
                            </div>
                        </div>
                        <div class="flex-grow">
                            <h4 class="text-lg font-bold mb-1">{{ . }}</h4>
                            <p class="text-sm text-muted-foreground leading-relaxed">
                                {{ i18n "author_bio" | default "Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­ØµØ±ÙŠØ© ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¬ÙˆØ¯Ø©." }}
                            </p>
                        </div>
                    </div>
                </div>
                {{ end }}

                {{/* --- RELATED POSTS --- */}}
                {{ $related := site.RegularPages.Related . | first 3 }}
                {{ with $related }}
                <div class="mt-16 pt-12 border-t-2 border-border">
                    <h3 class="text-3xl font-bold mb-8">ğŸ“š {{ i18n "related_posts" }}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {{ range . }}
                        <a href="{{ .RelPermalink }}" class="group block h-full">
                            <div class="bg-secondary/10 p-4 rounded-sm h-full hover:bg-secondary/20 transition-colors border border-border hover:border-primary group">
                                {{ with .Params.image }}
                                <div class="overflow-hidden rounded-sm mb-3">
                                    <img src="{{ . }}" alt="{{ $.Title }}"
                                        loading="lazy"
                                        class="w-full h-32 object-cover group-hover:scale-105 transition-transform duration-500">
                                </div>
                                {{ end }}
                                <h4 class="font-bold text-lg group-hover:text-primary transition-colors leading-snug mb-2">{{
                                    .Title }}</h4>
                                <p class="text-sm text-muted-foreground mb-3">{{ .Summary | truncate 80 }}</p>
                                <span class="text-xs text-primary font-semibold group-hover:translate-x-1 transition-transform inline-block">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯ â†</span>
                            </div>
                        </a>
                        {{ end }}
                    </div>
                </div>
                {{ end }}

                {{/* --- CALL TO ACTION --- */}}
                <div class="mt-16 p-8 bg-gradient-to-r from-primary/10 to-primary/5 rounded-sm border-2 border-primary/30 text-center">
                    <h3 class="text-2xl font-bold mb-2">{{ i18n "newsletter_title" | default "Ù‡Ù„ Ø£Ø¹Ø¬Ø¨Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ù„ØŸ" }}</h3>
                    <p class="text-muted-foreground mb-6">
                        {{ i18n "newsletter_description" | default "Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ù†Ø´Ø±Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠØ© Ù„ØªÙ„Ù‚ÙŠ Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø­ØµØ±ÙŠØ©" }}
                    </p>
                    <a href="/newsletter/" class="inline-block px-8 py-3 bg-primary text-primary-foreground rounded-sm font-bold hover:opacity-90 transition-opacity">
                        {{ i18n "subscribe" | default "Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†" }} âœ
                    </a>
                </div>
            </article>
        </main>

        {{/* --- SIDEBAR (4 Columns) --- */}}
        <aside class="lg:col-span-4 space-y-8">
            {{ if .Site.Params.sidebar.enable }}
            {{ partial "sidebar.html" . }}
            {{ end }}
        </aside>

    </div>
</div>
{{ end }}